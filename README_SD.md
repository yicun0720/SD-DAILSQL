# DAIL-SQL Evaluation for SQLDRILLER
This README is used to guide the evaluation of SQLDriller.

## Prerequisites
Follow the same instructions in the `Environment Setup` section of README.md to create a running environment.

## Reproduce on Spider
### Inference with the original train dataset

#### Data Preprocess
```
sh scripts/data_preprocess.sh -evaluation_step step2
```

#### Prompt Generation
Select examples with masked question similarity:
```
sh scripts/prompt_generation.sh -evaluation_step step2 -selector_type EUCDISQUESTIONMASK
```
Select examples considering both question similarity and query similarity:
```
sh scripts/prompt_generation.sh -evaluation_step step2 -selector_type EUCDISQUESTIONMASK -pre_test_result [your_pre_generated_queries_file]
```
Note: The `pre_generated_queries_file` is generated by a preliminary model. In our experiment, the file is generated by GPT with masked question similarity only.

#### Calling the LLM
```
sh scripts/call_llm.sh -openai_api_key [your_openai_api_key] -question [prompt_dir]
```
### Inference with the refined train dataset

#### Data Preprocess
```
sh scripts/data_preprocess.sh -evaluation_step step3
```

#### Prompt Generation
Select examples with masked question similarity:
```
sh scripts/prompt_generation.sh -evaluation_step step3 -selector_type EUCDISQUESTIONMASK
```
Select examples considering both question similarity and query similarity:
```
sh scripts/prompt_generation.sh -evaluation_step step3 -selector_type EUCDISQUESTIONMASK -pre_test_result [your_pre_generated_queries_file]
```
Note: The `pre_generated_queries_file` is generated by a preliminary model. In our experiment, the file is generated by GPT with masked question similarity only.

#### Calling the LLM
```
sh scripts/call_llm.sh -openai_api_key [your_openai_api_key] -question [prompt_dir]
```

### Inference with the refined train dataset to generate multiple predictions
Data Preprocess and Prompt Generation is the same with [Inference with the refined train dataset](#inference-with-the-refined-train-dataset).
#### Calling the LLM
```
sh scripts/call_llm.sh -openai_api_key [your_openai_api_key] -question [prompt_dir] -multi_preds true
```



